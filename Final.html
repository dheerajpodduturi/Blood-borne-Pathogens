<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bloodborne Pathogens Safety ‚Äî eLearning</title>
  <meta name="description" content="Modern continuous-scrolling Bloodborne Pathogens course aligned to OSHA 29 CFR 1910.1030." />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --bg: #f6f8fb;
      --panel: #ffffff;
      --panel2:#f1f7f6;
      --ink:#0f172a;
      --muted:#475569;
      --muted2:#64748b;
      --border: rgba(15,23,42,.10);
      --shadow: 0 10px 30px rgba(15,23,42,.08);
      --shadow2: 0 14px 44px rgba(15,23,42,.10);

      --teal:#0ea5a4;
      --teal2:#0b8a89; /* ‚úÖ brand green (enabled buttons) */
      --tealSoft: rgba(14,165,164,.12);

      --danger:#ef4444;
      --warn:#f59e0b;

      --r12: 12px;
      --r16: 16px;
      --r20: 20px;

      --max: 1100px;
      --navH: 70px;

      --ease: cubic-bezier(.2,.8,.2,1);
      --dur: 420ms;
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(900px 450px at 40% 0%, rgba(14,165,164,.14), transparent 55%),
        radial-gradient(700px 380px at 90% 4%, rgba(59,130,246,.10), transparent 55%),
        var(--bg);
      line-height:1.55;
    }

    a{color:var(--teal2); text-underline-offset: 3px}
    a:focus-visible, button:focus-visible, [role="button"]:focus-visible, input:focus-visible{
      outline:3px solid rgba(14,165,164,.35);
      outline-offset:3px;
      border-radius:12px;
    }

    .sr-only{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }

    /* Top Nav */
    .topbar{
      position:fixed; inset:0 0 auto 0;
      height:var(--navH);
      display:flex; align-items:center;
      background: rgba(255,255,255,.82);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--border);
      z-index:1000;
    }
    .topbar__inner{
      width:min(var(--max), calc(100% - 32px));
      margin:0 auto;
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800;
      letter-spacing:-.02em;
    }
    .brand__dot{
      width:10px; height:10px; border-radius:999px; background:var(--teal);
      box-shadow: 0 0 0 6px rgba(14,165,164,.12);
    }

    .topbar__right{
      display:flex; align-items:center; gap:12px;
    }
    .pill{
      display:inline-flex; align-items:center; gap:10px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(14,165,164,.35);
      background: rgba(14,165,164,.08);
      color: #0b6f6e;
      font-weight:700;
      font-size:13px;
      white-space:nowrap;
    }
    .avatar{
      width:36px; height:36px; border-radius:999px;
      overflow:hidden;
      border:2px solid rgba(14,165,164,.25);
      box-shadow: var(--shadow);
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.9), transparent 55%),
        linear-gradient(135deg, rgba(14,165,164,.55), rgba(59,130,246,.35));
      display:grid; place-items:center;
      font-weight:800; color:#0b3b3a;
    }

    /* Progress bar strip */
    .progressStrip{
      position:fixed; top:0; left:0; right:0;
      height:4px; background: transparent;
      z-index:1001;
    }
    .progressStrip > span{
      display:block; height:100%; width:0%;
      background: linear-gradient(90deg, var(--teal), var(--teal2));
      transition: width 120ms linear;
    }

    main{
      padding-top: calc(var(--navH) + 26px);
      padding-bottom: 70px;
    }

    /* ‚úÖ Page routing views */
    .pageView[hidden]{ display:none !important; }

    .wrap{
      width:min(var(--max), calc(100% - 32px));
      margin:0 auto;
      display:grid;
      grid-template-columns: 1fr 260px;
      gap:28px;
      align-items:start;
    }
    @media (max-width: 980px){
      .wrap{ grid-template-columns: 1fr; }
      .sideNav{ position:static !important; }
    }

    section{ margin: 0 0 26px; }
    .hero{ padding: 22px 0 10px; }

    .chips{ display:flex; flex-wrap:wrap; gap:10px; margin-bottom:16px; }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 12px;
      background: var(--panel);
      border:1px solid var(--border);
      border-radius: 999px;
      box-shadow: var(--shadow);
      font-weight:600;
      font-size:13px;
      color: var(--muted);
    }
    .chip svg{ width:16px; height:16px; color: var(--teal); }

    h1{
      margin:0;
      font-size: clamp(34px, 4vw, 54px);
      letter-spacing: -0.03em;
      line-height:1.08;
    }
    .lead{
      margin: 14px 0 0;
      max-width: 70ch;
      font-size: 16.5px;
      color: var(--muted);
    }

    .card{
      background: var(--panel);
      border:1px solid var(--border);
      border-radius: var(--r20);
      box-shadow: var(--shadow);
    }
    .card--soft{
      background: linear-gradient(180deg, rgba(14,165,164,.08), rgba(14,165,164,.03));
      border:1px solid rgba(14,165,164,.22);
    }
    .pad{ padding: 22px; }

    .videoFrame{
      width:100%;
      aspect-ratio: 16/9;
      border-radius: 18px;
      overflow:hidden;
      background: #0b1220;
      position:relative;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
    }
    .videoFrame iframe{ width:100%; height:100%; border:0; }
    .videoMeta{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding-top: 14px;
      border-top: 1px solid rgba(15,23,42,.08);
      margin-top: 14px;
      color: var(--muted2);
      font-size: 13px;
    }
    .checkboxLine{
      display:flex; align-items:center; gap:10px;
      color: var(--muted);
      font-weight:600;
    }
    .checkboxLine input{ width:18px; height:18px; accent-color: var(--teal); }

    .tag{
      display:inline-flex; align-items:center;
      padding: 6px 12px;
      border-radius: 999px;
      font-weight:800;
      font-size: 13px;
      background: rgba(14,165,164,.12);
      color: #0b6f6e;
    }
    .qTitle{
      margin: 10px 0 0;
      font-size: 26px;
      line-height:1.15;
      letter-spacing:-.02em;
    }

    /* Knowledge Check */
    .options{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      margin-top: 18px;
    }
    @media (max-width: 720px){
      .options{ grid-template-columns: 1fr; }
    }
    .opt{
      position: relative;
      display:flex; gap:12px; align-items:center;
      padding: 16px;
      border-radius: 14px;
      border: 1px solid rgba(15,23,42,.12);
      background: #fff;
      box-shadow: 0 6px 18px rgba(15,23,42,.05);
      cursor:pointer;
      transition: transform var(--dur) var(--ease), box-shadow var(--dur) var(--ease), border-color var(--dur) var(--ease), background var(--dur) var(--ease);
      user-select:none;
      min-height: 68px;
    }
    .opt:hover{ transform: translateY(-1px); box-shadow: 0 10px 26px rgba(15,23,42,.08); }
    .opt[data-selected="true"]{
      border-color: rgba(14,165,164,.95);
      background: rgba(14,165,164,.08);
      box-shadow: 0 12px 28px rgba(14,165,164,.12), 0 0 0 2px rgba(14,165,164,.20);
    }
    .opt[data-selected="true"]::before{
      content:"";
      position:absolute;
      left:0; top:10px; bottom:10px;
      width:6px;
      border-radius:999px;
      background: linear-gradient(180deg, var(--teal), var(--teal2));
    }
    .optLetter{
      width:34px; height:34px; border-radius:999px;
      background: rgba(15,23,42,.05);
      display:grid; place-items:center;
      font-weight:900;
      color: var(--muted);
      flex:0 0 auto;
    }
    .opt[data-selected="true"] .optLetter{
      background: var(--teal2);
      color:#fff;
      box-shadow: 0 10px 20px rgba(11,138,137,.18);
    }
    .optText{ font-weight:700; color: var(--ink); }

    /* ‚úÖ Buttons: disabled until answered, enabled uses brand green */
    .btnPrimary{
      width:100%;
      margin-top: 18px;
      border:0;
      border-radius: 10px;
      padding: 14px 16px;
      background: rgba(14,165,164,.25);
      color: #ffffff;
      font-weight: 900;
      font-size: 15px;
      cursor:not-allowed;
      transition: background var(--dur) var(--ease), transform var(--dur) var(--ease), filter var(--dur) var(--ease);
    }
    .btnPrimary.is-enabled{
      background: var(--teal2);
      cursor:pointer;
    }
    .btnPrimary.is-enabled:hover{
      filter: brightness(1.03);
      transform: translateY(-1px);
    }
    .btnPrimary:disabled{ opacity:1; transform:none; }

    .feedback{
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid rgba(15,23,42,.10);
      background: rgba(15,23,42,.03);
      color: var(--muted);
      font-weight: 650;
    }
    .feedback.good{
      border-color: rgba(34,197,94,.25);
      background: rgba(34,197,94,.10);
      color: #166534;
    }
    .feedback.bad{
      border-color: rgba(239,68,68,.25);
      background: rgba(239,68,68,.10);
      color: #7f1d1d;
    }

    /* Activity: keyboard-friendly move buttons (your original style) */
    .activityGrid{
      display:grid;
      grid-template-columns: 260px 1fr 1fr;
      gap:14px;
      margin-top: 14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .activityGrid{ grid-template-columns: 1fr; }
    }
    .bucket{
      border: 2px dashed rgba(100,116,139,.35);
      border-radius: 14px;
      min-height: 160px;
      padding: 10px;
      background: rgba(248,250,252,.60);
    }
    .bucket h4{
      margin: 6px 6px 10px;
      font-size: 14px;
      color: var(--muted);
      font-weight: 900;
    }
    .bucketBody{ min-height: 120px; }
    .item{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(15,23,42,.10);
      background: #fff;
      box-shadow: 0 6px 18px rgba(15,23,42,.05);
      margin-bottom: 10px;
    }
    .handle{
      display:inline-flex; align-items:center; justify-content:center;
      width:28px; height:28px;
      border-radius: 10px;
      background: rgba(15,23,42,.05);
      color: var(--muted2);
      flex:0 0 auto;
      font-weight:900;
    }
    .item strong{ font-size: 14px; }
    .moveBtns{ display:flex; gap:8px; }
    .miniBtn{
      border: 1px solid rgba(15,23,42,.10);
      background: rgba(248,250,252,.80);
      border-radius: 10px;
      padding: 8px 10px;
      font-weight: 800;
      color: var(--muted);
      cursor:pointer;
    }
    .miniBtn:hover{ border-color: rgba(14,165,164,.35); color:#0b6f6e; }

    /* Accordion */
    .acc{
      border-radius: 16px;
      overflow:hidden;
      border: 1px solid rgba(15,23,42,.10);
      background: #fff;
    }
    .acc + .acc{ margin-top: 10px; }
    .acc summary{
      list-style:none;
      display:flex; align-items:center; justify-content:space-between;
      padding: 14px 16px;
      cursor:pointer;
      font-weight: 900;
      color: var(--ink);
      user-select:none;
    }
    .acc summary::-webkit-details-marker{ display:none; }
    .dot{
      width:8px; height:8px; border-radius:999px;
      background: var(--danger);
      display:inline-block;
      margin-right:10px;
    }
    .accBody{
      padding: 0 16px 16px;
      color: var(--muted);
      font-weight: 600;
    }
    .accBody h5{
      margin: 12px 0 6px;
      color: var(--ink);
      font-size: 13px;
    }
    .accBody p{ margin:0; }

    /* Completion */
    .completeCard{
      text-align:center;
      padding: 28px 22px;
      background: linear-gradient(180deg, rgba(14,165,164,.10), rgba(14,165,164,.02));
      border:1px solid rgba(14,165,164,.28);
      border-radius: 20px;
      box-shadow: var(--shadow2);
    }
    .badgeRound{
      width:60px; height:60px;
      border-radius: 999px;
      margin: 0 auto 10px;
      background: rgba(14,165,164,.16);
      border: 1px solid rgba(14,165,164,.30);
      display:grid; place-items:center;
      color: var(--teal2);
    }
    .completeCard h3{
      margin: 8px 0 8px;
      font-size: 40px;
      letter-spacing: -.03em;
    }
    .completeCard p{
      margin:0 auto;
      max-width: 65ch;
      color: var(--muted);
      font-weight: 650;
    }
    .xpRow{
      display:flex; align-items:center; justify-content:center; gap:12px;
      margin-top: 16px;
      flex-wrap:wrap;
    }
    .xpPill{
      display:inline-flex; align-items:center; gap:8px;
      background: rgba(14,165,164,.15);
      border:1px solid rgba(14,165,164,.25);
      border-radius: 12px;
      padding: 10px 12px;
      font-weight: 900;
      color:#0b6f6e;
    }
    .barWrap{
      width:min(520px, 100%);
      margin: 16px auto 0;
    }
    .bar{
      height:10px; border-radius: 999px;
      background: rgba(15,23,42,.10);
      overflow:hidden;
    }
    .bar > span{
      display:block; height:100%; width:0%;
      background: linear-gradient(90deg, var(--teal), var(--teal2));
      transition: width var(--dur) var(--ease);
    }
    .continueBtn{
      margin-top: 18px;
      display:inline-flex; align-items:center; justify-content:center;
      gap:10px;
      padding: 12px 16px;
      border-radius: 12px;
      border:1px solid rgba(15,23,42,.10);
      background: #0b8a89;
      color:#fff;
      font-weight: 900;
      text-decoration:none;
      box-shadow: 0 10px 26px rgba(14,165,164,.22);
    }
    .continueBtn:hover{ filter: brightness(1.02); transform: translateY(-1px); }

    /* Right side lesson nav */
    .sideNav{
      position: sticky;
      top: calc(var(--navH) + 18px);
    }
    .sideCard{
      border-radius: 18px;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(15,23,42,.10);
      box-shadow: var(--shadow2);
      padding: 12px;
    }
    .navList{
      margin:0; padding:0;
      list-style:none;
      display:grid; gap:6px;
    }
    .navItem a{
      display:flex; align-items:center; gap:10px;
      padding: 10px 10px;
      border-radius: 12px;
      text-decoration:none;
      color: var(--muted);
      font-weight: 800;
      font-size: 13px;
    }
    .navItem a:hover{ background: rgba(14,165,164,.08); color:#0b6f6e; }
    .navItem a[aria-current="true"]{
      background: rgba(14,165,164,.10);
      color:#0b6f6e;
    }
    .bullet{
      width:8px; height:8px; border-radius:999px;
      background: rgba(100,116,139,.35);
    }
    .navItem a[aria-current="true"] .bullet{
      background: var(--teal);
      box-shadow: 0 0 0 6px rgba(14,165,164,.12);
    }

    /* Scroll reveal */
    .reveal{ opacity:0; transform: translateY(14px); transition: opacity var(--dur) var(--ease), transform var(--dur) var(--ease); }
    .reveal.in{ opacity:1; transform:none; }

    /* Floating help button + toast */
    .helpBtn{
      position: fixed;
      right: 16px;
      bottom: 16px;
      width: 44px; height: 44px;
      border-radius: 999px;
      border: 1px solid rgba(15,23,42,.12);
      background: rgba(255,255,255,.90);
      box-shadow: var(--shadow2);
      color: var(--muted);
      display:grid; place-items:center;
      cursor:pointer;
      z-index:1002;
    }
    .helpBtn:hover{ color:#0b6f6e; border-color: rgba(14,165,164,.28); }
    .toast{
      position: fixed;
      right: 16px;
      bottom: 70px;
      max-width: 320px;
      background: rgba(255,255,255,.95);
      border: 1px solid rgba(15,23,42,.12);
      border-radius: 14px;
      padding: 12px 12px;
      box-shadow: var(--shadow2);
      color: var(--muted);
      font-weight: 650;
      opacity:0;
      transform: translateY(10px);
      pointer-events:none;
      transition: opacity var(--dur) var(--ease), transform var(--dur) var(--ease);
      z-index:1002;
    }
    .toast.show{ opacity:1; transform:none; }

    @media print{
      .topbar, .progressStrip, .sideNav, .helpBtn, .toast { display:none !important; }
      body{ background:#fff; }
      main{ padding-top: 0; }
      .wrap{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="progressStrip" aria-hidden="true"><span id="progressBar"></span></div>

  <header class="topbar" role="banner">
    <div class="topbar__inner">
      <div class="brand" aria-label="Course title">
        <span class="brand__dot" aria-hidden="true"></span>
        <span>Bloodborne Pathogens Safety</span>
      </div>

      <div class="topbar__right">
        <div class="pill" aria-live="polite" aria-atomic="true">
          <span id="pct">0%</span> Complete
        </div>
        <div class="avatar" aria-label="Learner profile" title="Learner">
          <span aria-hidden="true">üë©‚Äç‚öïÔ∏è</span>
        </div>
      </div>
    </div>
  </header>

  <main id="main" role="main">

    <!-- =========================
         PAGE: MODULE 1
         ========================= -->
    <div id="page-module-1" class="pageView" data-page="module-1">
      <div class="wrap">
        <!-- CONTENT -->
        <div>
          <!-- HERO -->
          <section class="hero reveal" id="intro" data-section="Intro">
            <div class="chips" aria-label="Course metadata">
              <div class="chip">
                <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M12 7v5l3 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>~12 min</span>
              </div>
              <div class="chip">
                <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M16 11a4 4 0 1 0-8 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M4 20c1.6-3 4.3-5 8-5s6.4 2 8 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>Module 1 of 6</span>
              </div>
            </div>

            <h1>Module 1: Exposure Prevention &amp;<br/>Standard Precautions</h1>
            <p class="lead">
              Learn the critical protocols for minimizing exposure to bloodborne pathogens including proper PPE selection,
              hand hygiene, and safe sharps handling ‚Äî aligned to OSHA 29 CFR 1910.1030.
            </p>
          </section>

          <!-- VIDEO -->
          <section class="reveal" id="video" data-section="Video">
            <div class="card pad">
              <div class="videoFrame" aria-label="Training video">
                <iframe
                  title="Bloodborne Pathogens Training Video"
                  src="https://www.youtube.com/embed/2R4n8k7tY4o"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                  referrerpolicy="strict-origin-when-cross-origin"
                  allowfullscreen></iframe>
              </div>

              <h2 style="margin:16px 0 6px; letter-spacing:-.02em;">Understanding the Chain of Infection</h2>
              <div class="videoMeta">
                <span aria-label="Video duration">4:32</span>
                <label class="checkboxLine">
                  <input id="markVideo" type="checkbox" />
                  Mark as complete
                </label>
              </div>
            </div>
          </section>

          <!-- KNOWLEDGE CHECK -->
          <section class="reveal" id="knowledge-check" data-section="Knowledge Check">
            <div class="card pad">
              <span class="tag">Knowledge Check</span>
              <h2 class="qTitle">A healthcare worker sustains a needlestick injury. What is the <u>FIRST</u> action they should take?</h2>

              <div class="options" role="radiogroup" aria-label="Question 1 options" data-qid="q1">
                <div class="opt" role="radio" tabindex="0" aria-checked="false" data-opt="A">
                  <div class="optLetter" aria-hidden="true">A</div>
                  <div class="optText">File an incident report</div>
                </div>
                <div class="opt" role="radio" tabindex="0" aria-checked="false" data-opt="B">
                  <div class="optLetter" aria-hidden="true">B</div>
                  <div class="optText">Wash the area immediately with soap and water</div>
                </div>
                <div class="opt" role="radio" tabindex="0" aria-checked="false" data-opt="C">
                  <div class="optLetter" aria-hidden="true">C</div>
                  <div class="optText">Apply a bandage and continue working</div>
                </div>
                <div class="opt" role="radio" tabindex="0" aria-checked="false" data-opt="D">
                  <div class="optLetter" aria-hidden="true">D</div>
                  <div class="optText">Notify a supervisor</div>
                </div>
              </div>

              <!-- ‚úÖ disabled until selection -->
              <button class="btnPrimary" id="submitQ1" type="button" disabled>Submit Answer</button>
              <div class="feedback" id="fbQ1" role="status" aria-live="polite" hidden></div>
            </div>
          </section>

          <!-- READING -->
          <section class="reveal" id="reading" data-section="Reading">
            <h2 style="margin:0 0 10px; letter-spacing:-.02em; font-size:36px;">Understanding Standard Precautions</h2>
            <p class="lead" style="margin-top:0;">
              Standard Precautions represent the minimum infection prevention practices that apply to all patient care,
              regardless of suspected or confirmed infection status.
            </p>

            <div class="card card--soft pad" role="note" aria-label="Guidance note">
              <p style="margin:0; font-size:20px; font-weight:800; letter-spacing:-.02em; line-height:1.25;">
                ‚ÄúTreat all blood and body fluids as if they are infectious ‚Äî this single principle prevents the majority of occupational exposures.‚Äù
              </p>
              <small style="display:block; margin-top:10px; color:var(--muted2); font-weight:650;">
                ‚Äî Principle reflected in CDC Standard Precautions guidance
              </small>
            </div>

            <h3 style="margin:18px 0 8px; letter-spacing:-.02em; font-size:24px;">Core Components</h3>
            <p class="lead" style="margin:0;">
              Standard Precautions include hand hygiene, use of personal protective equipment (PPE), safe injection
              practices, safe handling of contaminated equipment, and respiratory hygiene/cough etiquette.
            </p>

            <div class="card" style="margin-top:16px;">
              <div style="display:flex; gap:16px; align-items:center; padding:18px 22px;">
                <div style="width:54px; height:54px; border-radius:16px; background: rgba(239,68,68,.12); border:1px solid rgba(239,68,68,.25); display:grid; place-items:center; color: var(--danger);">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M12 9v5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <path d="M12 17h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                    <path d="M10.2 4.6 2.6 18a2 2 0 0 0 1.7 3h15.4a2 2 0 0 0 1.7-3L13.8 4.6a2 2 0 0 0-3.6 0Z"
                          stroke="currentColor" stroke-width="2" />
                  </svg>
                </div>
                <div>
                  <p style="margin:0; font-size:46px; font-weight:900; letter-spacing:-.03em; line-height:1;">385,000</p>
                  <p style="margin:4px 0 0; color:var(--muted); font-weight:650;">Needlestick injuries occur among U.S. healthcare workers annually</p>
                  <p style="margin:0; color:var(--muted2); font-size:13px; font-weight:600;">Source: CDC/NIOSH (commonly cited estimate)</p>
                </div>
              </div>
            </div>
          </section>

          <!-- ACTIVITY -->
          <section class="reveal" id="activity" data-section="Activity">
            <div class="card pad">
              <span class="tag">Interactive Activity</span>
              <h2 class="qTitle" style="margin-top:10px;">
                Classify each action as a Standard Precaution or a Transmission-Based Precaution
              </h2>
              <p class="lead" style="margin-top:8px;">
                Use the buttons to move each item into the correct category. (Keyboard accessible.)
              </p>

              <div class="activityGrid" aria-label="Classification activity">
                <div>
                  <h3 style="margin:6px 0 10px; font-size:14px; color:var(--muted); font-weight:900;">Items to Sort</h3>
                  <div id="pool" aria-label="Items to sort"></div>
                </div>

                <div class="bucket" aria-label="Standard Precautions bucket" data-bucket="standard">
                  <h4>Standard Precautions</h4>
                  <div class="bucketBody" id="bucketStandard"></div>
                </div>

                <div class="bucket" aria-label="Transmission-Based Precautions bucket" data-bucket="transmission">
                  <h4>Transmission-Based Precautions</h4>
                  <div class="bucketBody" id="bucketTransmission"></div>
                </div>
              </div>

              <!-- ‚úÖ disabled until answered (pool empty) -->
              <button class="btnPrimary" id="checkActivity" type="button" disabled>Check My Answers</button>
              <div class="feedback" id="fbAct" role="status" aria-live="polite" hidden></div>
            </div>
          </section>

          <!-- REFERENCE / KEY PATHOGENS -->
          <section class="reveal" id="reference" data-section="Reference">
            <div class="card pad">
              <h2 style="margin:0; letter-spacing:-.02em; font-size:28px;">Key Pathogens at a Glance</h2>

              <details class="acc" open>
                <summary>
                  <span><span class="dot" style="background:#ef4444"></span>Hepatitis B (HBV)</span>
                  <span aria-hidden="true">‚åÑ</span>
                </summary>
                <div class="accBody">
                  <h5>Transmission Routes</h5>
                  <p>Contact with infectious blood or certain body fluids; commonly via needlestick injuries, mucous membrane exposure, or non-intact skin contact.</p>
                  <h5>Survivability on Surfaces</h5>
                  <p>Can remain infectious on environmental surfaces for up to 7 days under some conditions.</p>
                  <h5>Vaccine Availability</h5>
                  <p>Highly effective vaccine available; post-vaccination testing may be required by policy for some roles.</p>
                </div>
              </details>

              <details class="acc">
                <summary>
                  <span><span class="dot" style="background:#f97316"></span>Hepatitis C (HCV)</span>
                  <span aria-hidden="true">‚åÑ</span>
                </summary>
                <div class="accBody">
                  <h5>Transmission Routes</h5>
                  <p>Primarily blood-to-blood contact; occupational exposure commonly via sharps injuries.</p>
                  <h5>Vaccine Availability</h5>
                  <p>No vaccine currently available; early evaluation and follow-up testing after exposure is critical.</p>
                </div>
              </details>

              <details class="acc">
                <summary>
                  <span><span class="dot" style="background:#eab308"></span>HIV</span>
                  <span aria-hidden="true">‚åÑ</span>
                </summary>
                <div class="accBody">
                  <h5>Transmission Routes</h5>
                  <p>Blood or potentially infectious body fluids contacting mucous membranes, non-intact skin, or percutaneous injury.</p>
                  <h5>Post-Exposure Prophylaxis (PEP)</h5>
                  <p>PEP should be evaluated urgently after exposure ‚Äî many protocols recommend initiation as soon as possible.</p>
                </div>
              </details>
            </div>
          </section>

          <!-- COMPLETE -->
          <section class="reveal" id="complete" data-section="Complete">
            <div class="completeCard" role="region" aria-label="Module completion">
              <div class="badgeRound" aria-hidden="true">
                <svg width="26" height="26" viewBox="0 0 24 24" fill="none">
                  <path d="M12 2 20 5v7c0 5-3.6 9-8 10-4.4-1-8-5-8-10V5l8-3Z" stroke="currentColor" stroke-width="2"/>
                  <path d="m8 12 2.2 2.2L16 8.6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>
              <h3>Module 1 Complete!</h3>
              <p>Excellent work! You‚Äôve practiced exposure prevention and standard precautions ‚Äî critical skills for maintaining safety in clinical environments.</p>

              <div class="xpRow">
                <div class="xpPill"><span aria-hidden="true">üèÜ</span><span>+ 150 XP</span></div>
                <div style="color:var(--muted); font-weight:750;">Module 1 of 6 completed</div>
              </div>

              <div class="barWrap" aria-label="Module progress">
                <div class="bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="16">
                  <span id="moduleBar"></span>
                </div>
                <div style="margin-top:8px; color:var(--muted); font-weight:750;">16% of course complete</div>
              </div>

              <!-- ‚úÖ now routes to module 2 "page" -->
              <a class="continueBtn" href="#/module-2" id="continueBtn">
                Continue to Module 2: Types of Bloodborne Pathogens
                <span aria-hidden="true">‚Üí</span>
              </a>
            </div>
          </section>
        </div>

        <!-- SIDE NAV (Module 1) -->
        <aside class="sideNav" aria-label="Lesson navigation">
          <div class="sideCard">
            <ul class="navList" id="lessonNav">
              <li class="navItem"><a href="#intro" data-link="Intro"><span class="bullet" aria-hidden="true"></span>Intro</a></li>
              <li class="navItem"><a href="#video" data-link="Video"><span class="bullet" aria-hidden="true"></span>Video</a></li>
              <li class="navItem"><a href="#knowledge-check" data-link="Knowledge Check"><span class="bullet" aria-hidden="true"></span>Knowledge<br/>Check</a></li>
              <li class="navItem"><a href="#reading" data-link="Reading"><span class="bullet" aria-hidden="true"></span>Reading</a></li>
              <li class="navItem"><a href="#activity" data-link="Activity"><span class="bullet" aria-hidden="true"></span>Activity</a></li>
              <li class="navItem"><a href="#reference" data-link="Reference"><span class="bullet" aria-hidden="true"></span>Reference</a></li>
              <li class="navItem"><a href="#complete" data-link="Complete"><span class="bullet" aria-hidden="true"></span>Complete</a></li>
            </ul>
          </div>
        </aside>
      </div>
    </div>

    <!-- =========================
         PAGE: MODULE 2
         ========================= -->
    <div id="page-module-2" class="pageView" data-page="module-2" hidden>
      <div class="wrap">
        <!-- CONTENT -->
        <div>
          <section class="hero reveal" id="m2-intro" data-section="Intro">
            <div class="chips" aria-label="Course metadata">
              <div class="chip">
                <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M12 7v5l3 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>~12 min</span>
              </div>
              <div class="chip">
                <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M16 11a4 4 0 1 0-8 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M4 20c1.6-3 4.3-5 8-5s6.4 2 8 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>Module 2 of 6</span>
              </div>
            </div>

            <h1>Module 2: Types of Bloodborne Pathogens</h1>
            <p class="lead">
              Learn the major bloodborne pathogens of concern in healthcare settings ‚Äî Hepatitis B (HBV),
              Hepatitis C (HCV), and HIV ‚Äî and why prevention matters in occupational exposure scenarios.
            </p>
          </section>

          <section class="reveal" id="m2-video" data-section="Video">
            <div class="card pad">
              <div class="videoFrame" aria-label="Training video">
                <iframe
                  title="Bloodborne Pathogens Overview Video"
                  src="https://www.youtube.com/embed/2R4n8k7tY4o"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                  referrerpolicy="strict-origin-when-cross-origin"
                  allowfullscreen></iframe>
              </div>

              <h2 style="margin:16px 0 6px; letter-spacing:-.02em;">Meet the Big Three: HBV, HCV, HIV</h2>
              <div class="videoMeta">
                <span aria-label="Video duration">4:32</span>
                <label class="checkboxLine">
                  <input id="m2-markVideo" type="checkbox" />
                  Mark as complete
                </label>
              </div>
            </div>
          </section>

          <section class="reveal" id="m2-reading" data-section="Reading">
            <div class="card pad">
              <span class="tag">Reading</span>
              <h2 class="qTitle">What makes these pathogens important?</h2>
              <p class="lead" style="margin-top:10px;">
                OSHA‚Äôs Bloodborne Pathogens Standard covers occupational exposure to blood and OPIM.
                HBV, HCV, and HIV are emphasized because exposure can cause serious illness and long-term health impacts.
              </p>

              <div style="display:grid; gap:12px; margin-top:14px">
                <div style="padding:14px;border-radius:14px;border:1px solid rgba(15,23,42,.10);background:rgba(14,165,164,.06)">
                  <b>HBV (Hepatitis B)</b><br/>
                  <span style="color:var(--muted);font-weight:650">
                    Vaccine-preventable. Can survive on surfaces for days under some conditions. Can cause chronic liver disease.
                  </span>
                </div>

                <div style="padding:14px;border-radius:14px;border:1px solid rgba(15,23,42,.10);background:rgba(14,165,164,.06)">
                  <b>HCV (Hepatitis C)</b><br/>
                  <span style="color:var(--muted);font-weight:650">
                    No vaccine. Often asymptomatic early. Can lead to chronic infection and liver damage.
                  </span>
                </div>

                <div style="padding:14px;border-radius:14px;border:1px solid rgba(15,23,42,.10);background:rgba(14,165,164,.06)">
                  <b>HIV</b><br/>
                  <span style="color:var(--muted);font-weight:650">
                    Attacks immune system. PEP evaluation is time-sensitive after a significant exposure event.
                  </span>
                </div>
              </div>
            </div>
          </section>

          <section class="reveal" id="m2-knowledge-check" data-section="Knowledge Check">
            <div class="card pad">
              <span class="tag">Knowledge Check</span>
              <h2 class="qTitle">Which bloodborne pathogen has a widely available and effective vaccine?</h2>

              <div class="options" role="radiogroup" aria-label="Module 2 question options" data-qid="m2q1">
                <div class="opt" role="radio" tabindex="0" aria-checked="false" data-opt="A">
                  <div class="optLetter" aria-hidden="true">A</div>
                  <div class="optText">Hepatitis C (HCV)</div>
                </div>
                <div class="opt" role="radio" tabindex="0" aria-checked="false" data-opt="B">
                  <div class="optLetter" aria-hidden="true">B</div>
                  <div class="optText">Hepatitis B (HBV)</div>
                </div>
                <div class="opt" role="radio" tabindex="0" aria-checked="false" data-opt="C">
                  <div class="optLetter" aria-hidden="true">C</div>
                  <div class="optText">HIV</div>
                </div>
                <div class="opt" role="radio" tabindex="0" aria-checked="false" data-opt="D">
                  <div class="optLetter" aria-hidden="true">D</div>
                  <div class="optText">All of the above</div>
                </div>
              </div>

              <button class="btnPrimary" id="m2-submitQ1" type="button" disabled>Submit Answer</button>
              <div class="feedback" id="m2-fbQ1" role="status" aria-live="polite" hidden></div>
            </div>
          </section>

          <section class="reveal" id="m2-complete" data-section="Complete">
            <div class="completeCard" role="region" aria-label="Module completion">
              <div class="badgeRound" aria-hidden="true">
                <svg width="26" height="26" viewBox="0 0 24 24" fill="none">
                  <path d="M12 2 20 5v7c0 5-3.6 9-8 10-4.4-1-8-5-8-10V5l8-3Z" stroke="currentColor" stroke-width="2"/>
                  <path d="m8 12 2.2 2.2L16 8.6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>
              <h3>Module 2 Complete!</h3>
              <p>You‚Äôve identified the major pathogens emphasized in BBP training and what makes them significant occupational risks.</p>

              <div class="xpRow">
                <div class="xpPill"><span aria-hidden="true">üèÜ</span><span>+ 150 XP</span></div>
                <div style="color:var(--muted); font-weight:750;">Module 2 of 6 completed</div>
              </div>

              <div class="barWrap" aria-label="Module progress">
                <div class="bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="33">
                  <span id="m2-moduleBar"></span>
                </div>
                <div style="margin-top:8px; color:var(--muted); font-weight:750;">33% of course complete</div>
              </div>

              <a class="continueBtn" href="#/module-1">
                Back to Module 1
                <span aria-hidden="true">‚Üê</span>
              </a>
            </div>
          </section>
        </div>

        <!-- SIDE NAV (Module 2) -->
        <aside class="sideNav" aria-label="Lesson navigation">
          <div class="sideCard">
            <ul class="navList" id="lessonNavM2">
              <li class="navItem"><a href="#m2-intro" data-link="Intro"><span class="bullet" aria-hidden="true"></span>Intro</a></li>
              <li class="navItem"><a href="#m2-video" data-link="Video"><span class="bullet" aria-hidden="true"></span>Video</a></li>
              <li class="navItem"><a href="#m2-reading" data-link="Reading"><span class="bullet" aria-hidden="true"></span>Reading</a></li>
              <li class="navItem"><a href="#m2-knowledge-check" data-link="Knowledge Check"><span class="bullet" aria-hidden="true"></span>Knowledge<br/>Check</a></li>
              <li class="navItem"><a href="#m2-complete" data-link="Complete"><span class="bullet" aria-hidden="true"></span>Complete</a></li>
            </ul>
          </div>
        </aside>
      </div>
    </div>

  </main>

  <button class="helpBtn" id="helpBtn" type="button" aria-label="Help">?</button>
  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    /***********************
     * Tracking (Standalone)
     * - time per section
     * - all clicks
     * - knowledge check details
     ***********************/
    const STORE_KEY = "bbp_standalone_tracking_v2_router";
    const state = loadState();

    function loadState(){
      try{
        return JSON.parse(localStorage.getItem(STORE_KEY)) || {
          startedAt: Date.now(),
          currentPage: "module-1",
          sectionTimeMs: {},        // { "module-1::Intro": 1234 }
          currentSection: null,
          sectionEnteredAt: null,
          interactions: [],         // {t, type, id, meta}
          quiz: {
            q1: { attempts:0, selected:null, correct:null },
            m2q1: { attempts:0, selected:null, correct:null }
          },
          activity: { checked:false, correctCount:0, total:0, placement:{} }
        };
      }catch(e){
        return {
          startedAt: Date.now(),
          currentPage:"module-1",
          sectionTimeMs:{},
          currentSection:null,
          sectionEnteredAt:null,
          interactions:[],
          quiz:{ q1:{attempts:0, selected:null, correct:null}, m2q1:{attempts:0, selected:null, correct:null} },
          activity:{ checked:false, correctCount:0, total:0, placement:{} }
        };
      }
    }
    function saveState(){ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }
    function logInteraction(type, id, meta={}){
      state.interactions.push({ t: Date.now(), type, id, meta });
      saveState();
    }

    // Progress calculation based on scroll
    const progressBar = document.getElementById("progressBar");
    const pctEl = document.getElementById("pct");

    function updateProgress(){
      const doc = document.documentElement;
      const scrollTop = doc.scrollTop || document.body.scrollTop;
      const scrollHeight = doc.scrollHeight - doc.clientHeight;
      const p = scrollHeight > 0 ? Math.min(1, Math.max(0, scrollTop / scrollHeight)) : 0;
      const pct = Math.round(p * 100);
      progressBar.style.width = pct + "%";
      pctEl.textContent = pct + "%";
      return pct;
    }
    window.addEventListener("scroll", updateProgress, { passive:true });
    updateProgress();

    // Scroll reveal (global observer)
    const revealIO = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting) e.target.classList.add("in");
      });
    }, { threshold: 0.18 });

    function observeReveals(pageEl){
      pageEl.querySelectorAll(".reveal").forEach(el=>{
        el.classList.remove("in");
        revealIO.observe(el);
      });
    }

    // Help button
    const helpBtn = document.getElementById("helpBtn");
    const toast = document.getElementById("toast");
    helpBtn.addEventListener("click", ()=>{
      showToast("Tip: Use the right-side menu to jump sections. Use keyboard to answer interactions.");
      logInteraction("help", "helpBtn", { page: state.currentPage });
    });
    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(()=>toast.classList.remove("show"), 3200);
    }

    // Global click tracking
    document.addEventListener("click", (e)=>{
      const t = e.target.closest("button,a,input,[role='radio']");
      if(!t) return;
      const id = t.id || t.getAttribute("href") || t.getAttribute("data-opt") || t.getAttribute("aria-label") || t.textContent.trim().slice(0,30);
      logInteraction("click", id, { tag: t.tagName.toLowerCase(), page: state.currentPage });
    }, true);

    // --------- Page Router ----------
    const pages = {
      "module-1": document.getElementById("page-module-1"),
      "module-2": document.getElementById("page-module-2")
    };

    let sectionIO = null;

    function makeSectionKey(page, section){ return `${page}::${section}`; }

    function commitSectionTime(nextSectionName){
      const now = Date.now();
      if(state.currentSection && state.sectionEnteredAt){
        const delta = now - state.sectionEnteredAt;
        const key = makeSectionKey(state.currentPage, state.currentSection);
        state.sectionTimeMs[key] = (state.sectionTimeMs[key] || 0) + delta;
      }
      state.currentSection = nextSectionName;
      state.sectionEnteredAt = now;
      saveState();
    }

    function setupSectionObserverForPage(pageKey){
      if(sectionIO) sectionIO.disconnect();

      const pageEl = pages[pageKey];
      if(!pageEl) return;

      const sections = [...pageEl.querySelectorAll("section[data-section]")];
      const nav = pageKey === "module-2"
        ? [...pageEl.querySelectorAll("#lessonNavM2 a")]
        : [...pageEl.querySelectorAll("#lessonNav a")];

      function setCurrentNav(sectionName){
        nav.forEach(a => a.setAttribute("aria-current", a.dataset.link === sectionName ? "true" : "false"));
      }

      sectionIO = new IntersectionObserver((entries)=>{
        entries.forEach(entry=>{
          if(entry.isIntersecting){
            const name = entry.target.getAttribute("data-section");
            setCurrentNav(name);
            if(state.currentSection !== name){
              commitSectionTime(name);
            }
          }
        });
      }, { root:null, threshold: 0.55 });

      sections.forEach(s => sectionIO.observe(s));

      // ensure initial section on page
      if(!state.currentSection){
        state.currentSection = sections[0]?.getAttribute("data-section") || "Intro";
        state.sectionEnteredAt = Date.now();
        saveState();
      }
    }

    function showPage(pageKey){
      Object.entries(pages).forEach(([k, el])=>{
        if(!el) return;
        el.hidden = (k !== pageKey);
      });

      // update state page
      if(state.currentPage !== pageKey){
        // close previous section timer
        commitSectionTime(state.currentSection || "Intro");
        state.currentPage = pageKey;
        state.currentSection = null;
        state.sectionEnteredAt = null;
        saveState();
      }

      // scroll top like a new page
      window.scrollTo({ top: 0, behavior: "instant" });

      // reveal animations
      observeReveals(pages[pageKey]);

      // section observer + nav
      setupSectionObserverForPage(pageKey);

      // update progress
      updateProgress();
    }

    function getRoute(){
      const hash = (location.hash || "#/module-1").toLowerCase();
      const m = hash.match(/^#\/(module-\d+)/);
      return (m && pages[m[1]]) ? m[1] : "module-1";
    }

    window.addEventListener("hashchange", ()=>{
      showPage(getRoute());
    });

    // initial route
    showPage(getRoute());

    // commit time on unload
    window.addEventListener("beforeunload", () => {
      commitSectionTime(state.currentSection || "Intro");
    });

    // --------- Module 1 video toggle ----------
    const markVideo = document.getElementById("markVideo");
    if(markVideo){
      markVideo.addEventListener("change", ()=>{
        logInteraction("video_complete_toggle", "markVideo", { checked: markVideo.checked, page:"module-1" });
        showToast(markVideo.checked ? "Video marked complete." : "Video unmarked.");
      });
    }

    // --------- Module 2 video toggle ----------
    const m2MarkVideo = document.getElementById("m2-markVideo");
    if(m2MarkVideo){
      m2MarkVideo.addEventListener("change", ()=>{
        logInteraction("video_complete_toggle", "m2-markVideo", { checked: m2MarkVideo.checked, page:"module-2" });
      });
    }

    /***********************
     * Knowledge Check Module 1
     * ‚úÖ submit disabled until selection
     ***********************/
    const q1Correct = "B";
    const q1Opts = [...document.querySelectorAll(".options[data-qid='q1'] .opt")];
    const submitQ1 = document.getElementById("submitQ1");
    const fbQ1 = document.getElementById("fbQ1");

    function enableBtn(btn){
      btn.disabled = false;
      btn.classList.add("is-enabled");
      btn.setAttribute("aria-disabled","false");
    }
    function disableBtn(btn){
      btn.disabled = true;
      btn.classList.remove("is-enabled");
      btn.setAttribute("aria-disabled","true");
    }

    if(submitQ1) disableBtn(submitQ1);

    function selectQ1(optEl){
      q1Opts.forEach(o=>{
        o.dataset.selected = "false";
        o.setAttribute("aria-checked","false");
      });
      optEl.dataset.selected = "true";
      optEl.setAttribute("aria-checked","true");

      state.quiz.q1.selected = optEl.dataset.opt;
      saveState();

      if(submitQ1) enableBtn(submitQ1);

      logInteraction("quiz_select", "q1", { selected: state.quiz.q1.selected, page:"module-1" });
    }

    q1Opts.forEach(opt=>{
      opt.addEventListener("click", ()=>selectQ1(opt));
      opt.addEventListener("keydown", (e)=>{
        if(e.key === "Enter" || e.key === " "){
          e.preventDefault();
          selectQ1(opt);
        }
      });
    });

    if(submitQ1){
      submitQ1.addEventListener("click", ()=>{
        if(!state.quiz.q1.selected){
          fbQ1.hidden = false;
          fbQ1.className = "feedback bad";
          fbQ1.textContent = "Please select an answer before submitting.";
          return;
        }
        state.quiz.q1.attempts += 1;
        const correct = state.quiz.q1.selected === q1Correct;
        state.quiz.q1.correct = correct;
        saveState();

        fbQ1.hidden = false;
        fbQ1.className = "feedback " + (correct ? "good" : "bad");
        fbQ1.textContent = correct
          ? "Correct. First, wash the area immediately with soap and water. Then report and follow your facility‚Äôs exposure protocol."
          : "Not quite. The first step is immediate decontamination: wash the area with soap and water (or flush mucous membranes). Then report and follow protocol.";

        logInteraction("quiz_submit", "q1", {
          question: "Needlestick: first action?",
          selected: state.quiz.q1.selected,
          correct,
          attempts: state.quiz.q1.attempts,
          page:"module-1"
        });
      });
    }

    /***********************
     * Knowledge Check Module 2
     * ‚úÖ submit disabled until selection
     ***********************/
    const m2Correct = "B";
    const m2Opts = [...document.querySelectorAll(".options[data-qid='m2q1'] .opt")];
    const m2Submit = document.getElementById("m2-submitQ1");
    const m2Fb = document.getElementById("m2-fbQ1");
    if(m2Submit) disableBtn(m2Submit);

    function selectM2(optEl){
      m2Opts.forEach(o=>{
        o.dataset.selected = "false";
        o.setAttribute("aria-checked","false");
      });
      optEl.dataset.selected = "true";
      optEl.setAttribute("aria-checked","true");

      state.quiz.m2q1.selected = optEl.dataset.opt;
      saveState();

      if(m2Submit) enableBtn(m2Submit);
      logInteraction("quiz_select", "m2q1", { selected: state.quiz.m2q1.selected, page:"module-2" });
    }

    m2Opts.forEach(opt=>{
      opt.addEventListener("click", ()=>selectM2(opt));
      opt.addEventListener("keydown", (e)=>{
        if(e.key === "Enter" || e.key === " "){
          e.preventDefault();
          selectM2(opt);
        }
      });
    });

    if(m2Submit){
      m2Submit.addEventListener("click", ()=>{
        if(!state.quiz.m2q1.selected){
          m2Fb.hidden = false;
          m2Fb.className = "feedback bad";
          m2Fb.textContent = "Please select an answer before submitting.";
          return;
        }
        state.quiz.m2q1.attempts += 1;
        const correct = state.quiz.m2q1.selected === m2Correct;
        state.quiz.m2q1.correct = correct;
        saveState();

        m2Fb.hidden = false;
        m2Fb.className = "feedback " + (correct ? "good" : "bad");
        m2Fb.textContent = correct
          ? "Correct. Hepatitis B (HBV) has a widely available, effective vaccine."
          : "Not quite. HBV has a vaccine; HCV and HIV do not have preventive vaccines.";

        logInteraction("quiz_submit", "m2q1", {
          question: "Which pathogen has a vaccine?",
          selected: state.quiz.m2q1.selected,
          correct,
          attempts: state.quiz.m2q1.attempts,
          page:"module-2"
        });
      });
    }

    /***********************
     * Activity Module 1
     * ‚úÖ Check enabled only when answered (pool empty)
     ***********************/
    const items = [
      { id:"i1", text:"Hand hygiene between patients", correct:"standard" },
      { id:"i2", text:"N95 respirator use", correct:"transmission" },
      { id:"i3", text:"Gloves for blood contact", correct:"standard" },
      { id:"i4", text:"Negative pressure room", correct:"transmission" },
      { id:"i5", text:"Safe sharps disposal", correct:"standard" }
    ];

    const pool = document.getElementById("pool");
    const bucketStandard = document.getElementById("bucketStandard");
    const bucketTransmission = document.getElementById("bucketTransmission");
    const checkActivity = document.getElementById("checkActivity");
    const fbAct = document.getElementById("fbAct");

    const placement = new Map(); // id -> "pool"|"standard"|"transmission"

    function updateActivityAnsweredState(){
      if(!pool || !checkActivity) return;
      const remaining = pool.querySelectorAll(".item").length;
      const answered = remaining === 0;
      if(answered) enableBtn(checkActivity);
      else disableBtn(checkActivity);
    }

    function renderItem(it){
      const row = document.createElement("div");
      row.className = "item";
      row.setAttribute("data-item", it.id);

      const left = document.createElement("div");
      left.style.display="flex";
      left.style.alignItems="center";
      left.style.gap="10px";

      const handle = document.createElement("span");
      handle.className = "handle";
      handle.setAttribute("aria-hidden","true");
      handle.innerHTML = "‚ãÆ‚ãÆ";

      const label = document.createElement("strong");
      label.textContent = it.text;
      left.append(handle, label);

      const btns = document.createElement("div");
      btns.className = "moveBtns";

      const bPool = mkMini("Pool", ()=>moveTo(it.id, "pool"));
      const bStd  = mkMini("Standard", ()=>moveTo(it.id, "standard"));
      const bTrn  = mkMini("Transmission", ()=>moveTo(it.id, "transmission"));

      btns.append(bPool,bStd,bTrn);
      row.append(left, btns);
      return row;

      function mkMini(txt, onClick){
        const b = document.createElement("button");
        b.type="button";
        b.className="miniBtn";
        b.textContent=txt;
        b.addEventListener("click", ()=>{
          onClick();
          logInteraction("activity_move", it.id, { to: placement.get(it.id), page:"module-1" });
        });
        return b;
      }
    }

    function mount(){
      if(!pool) return;
      pool.innerHTML = "";
      bucketStandard.innerHTML = "";
      bucketTransmission.innerHTML = "";
      items.forEach(it=>{
        placement.set(it.id, "pool");
        pool.append(renderItem(it));
      });
      state.activity.total = items.length;
      state.activity.placement = Object.fromEntries(placement.entries());
      saveState();
      updateActivityAnsweredState();
    }
    mount();

    function moveTo(id, where){
      placement.set(id, where);
      const node = document.querySelector(`[data-item="${id}"]`);
      if(!node) return;
      if(where === "pool") pool.append(node);
      if(where === "standard") bucketStandard.append(node);
      if(where === "transmission") bucketTransmission.append(node);

      state.activity.placement = Object.fromEntries(placement.entries());
      saveState();
      updateActivityAnsweredState();
    }

    if(checkActivity){
      checkActivity.addEventListener("click", ()=>{
        if(checkActivity.disabled) return;

        let correctCount = 0;
        items.forEach(it=>{
          if(placement.get(it.id) === it.correct) correctCount++;
        });
        state.activity.checked = true;
        state.activity.correctCount = correctCount;
        state.activity.placement = Object.fromEntries(placement.entries());
        saveState();

        fbAct.hidden = false;
        const ok = correctCount === items.length;
        fbAct.className = "feedback " + (ok ? "good" : "bad");
        fbAct.textContent = ok
          ? "Nice work ‚Äî all items are correctly classified."
          : `You classified ${correctCount}/${items.length} correctly. Review Standard vs Transmission-Based precautions and try again.`;

        logInteraction("activity_check", "classify", {
          correctCount, total: items.length,
          placement: Object.fromEntries(placement.entries()),
          page:"module-1"
        });
      });
    }

    // Completion bars
    const moduleBar = document.getElementById("moduleBar");
    if(moduleBar) moduleBar.style.width = "16%";
    const m2Bar = document.getElementById("m2-moduleBar");
    if(m2Bar) m2Bar.style.width = "33%";
  </script>
</body>
</html>
